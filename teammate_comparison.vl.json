{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",

  "title": {
    "text": "Australian GP Winners vs Teammate (Season Performance)",
    "anchor": "start",
    "fontSize": 16
  },

  "autosize": {"type": "fit", "contains": "padding"},

  "data": {
    "url": "https://raw.githubusercontent.com/ericluo-aot/FIT3179-V2/refs/heads/main/season_points_winners.csv"
  },

  "transform": [
    {"filter": "datum.season >= 2018"},
    {"calculate": "datum.role === 'Winner' ? 'Winner' : 'Teammate'", "as": "Role"},
    {
      "calculate": "datum.role === 'Winner' ? datum.constructorName : datum.constructorName + '_teammate'",
      "as": "lineColorKey"
    }
  ],

  "facet": {
    "field": "facetTitle",
    "type": "ordinal",
    "sort": "ascending",
    "columns": 5,
    "header": {"title": null, "labelFontSize": 12, "labelPadding": 8}
  },

  "spec": {
    "width": 220,
    "height": 220,

    "params": [
      {
        "name": "Hover",
        "select": {
          "type": "point",
          "fields": ["driverName", "season"],
          "on": "pointerover",
          "clear": "mouseout"
        }
      }
    ],

    "layer": [
      {
        "mark": {"type": "circle", "opacity": 0, "size": 900},
        "encoding": {
          "x": {"field": "round", "type": "quantitative"},
          "y": {"field": "cumulative_points", "type": "quantitative"},
          "tooltip": [
            {"field": "season", "title": "Season"},
            {"field": "Role", "title": "Role"},
            {"field": "driverName", "title": "Driver"},
            {"field": "constructorName", "title": "Constructor"},
            {"field": "raceName", "title": "Race"},
            {"field": "positionOrder", "title": "Finish"},
            {"field": "driver_standings", "title": "Standings (driver)"},
            {"field": "cumulative_points", "title": "Cumulative points"}
          ]
        }
      },

      {
        "mark": {"type": "line", "interpolate": "monotone"},
        "encoding": {
          "x": {
            "field": "round",
            "type": "quantitative",
            "title": "Round",
            "axis": {"tickMinStep": 1}
          },
          "y": {
            "field": "cumulative_points",
            "type": "quantitative",
            "title": "Cumulative points"
          },
          "color": {
            "field": "lineColorKey",
            "type": "nominal",
            "scale": {
              "domain": [
                "Mercedes", "Mercedes_teammate",
                "Red Bull", "Red Bull_teammate",
                "Ferrari", "Ferrari_teammate"
              ],
              "range": [
                "#00D2BE", "#00D2BE66",
                "#1E41FF", "#1E41FF66",
                "#DC0000", "#DC000066"
              ]
            },
            "legend": null
          },
          "strokeDash": {
            "field": "Role",
            "type": "nominal",
            "scale": {"domain": ["Winner", "Teammate"], "range": [[], [6, 4]]}
          },
          "strokeWidth": {
            "condition": {"param": "Hover", "value": 3.5},
            "value": 2.5
          },
          "opacity": {
            "condition": {"param": "Hover", "value": 1},
            "value": 0.7
          },
          "detail": {"field": "driverName"}
        }
      },

      {
        "mark": {"type": "circle", "opacity": 0.9},
        "encoding": {
          "x": {"field": "round", "type": "quantitative"},
          "y": {"field": "cumulative_points", "type": "quantitative"},
          "color": {"field": "lineColorKey", "type": "nominal", "legend": null},
          "size": {
            "condition": {"test": "datum.isAusGP == 1", "value": 130},
            "value": 55
          },
          "opacity": {
            "condition": {"param": "Hover", "value": 1},
            "value": 0.85
          },
          "tooltip": [
            {"field": "season", "title": "Season"},
            {"field": "Role", "title": "Role"},
            {"field": "driverName", "title": "Driver"},
            {"field": "constructorName", "title": "Constructor"},
            {"field": "raceName", "title": "Race"},
            {"field": "positionOrder", "title": "Finish"},
            {"field": "driver_standings", "title": "Standings (driver)"},
            {"field": "cumulative_points", "title": "Cumulative points"}
          ]
        }
      }
    ]
  },

  "resolve": {"scale": {"y": "shared", "x": "shared"}},

  "config": {
    "facet": {"spacing": 18},
    "legend": {"disable": true},
    "view": {"stroke": "transparent", "padding": 6},
    "axis": {
      "grid": true,
      "gridColor": "#ececec",
      "labelFont": "Inter, Arial, sans-serif",
      "titleFont": "Inter, Arial, sans-serif",
      "labelFontSize": 12,
      "titleFontSize": 13
    },
    "title": {
      "font": "Inter, Arial, sans-serif",
      "subtitleFont": "Inter, Arial, sans-serif"
    },
    "tooltip": {
      "content": "data",
      "font": "Inter, Arial, sans-serif",
      "fontSize": 12
    }
  }
}
